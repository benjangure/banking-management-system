<div class="withdraw-container">
  <mat-card class="withdraw-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>remove_circle</mat-icon>
        Withdraw Money
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-form-field class="full-width">
        <mat-label>Select Account</mat-label>
        <mat-select [(ngModel)]="selectedAccount" [disabled]="isLoading || isInitializing">
          <mat-option *ngFor="let account of userAccounts" [value]="account">
            {{ account.accountType }} - {{ account.accountNumber }} (KSh {{ account.balance | number:'1.2-2' }})
          </mat-option>
        </mat-select>
        <mat-hint *ngIf="isInitializing">Loading accounts...</mat-hint>
      </mat-form-field>

      <mat-form-field class="full-width">
        <mat-label>Amount</mat-label>
        <input matInput type="number" [(ngModel)]="amount" min="10" step="0.01" [disabled]="isLoading">
        <mat-icon matSuffix>attach_money</mat-icon>
      </mat-form-field>

      <mat-form-field class="full-width">
        <mat-label>Description (Optional)</mat-label>
        <textarea matInput [(ngModel)]="description" rows="3" [disabled]="isLoading"></textarea>
      </mat-form-field>

      <!-- Info messages - Shows BEFORE validation -->
      <div class="info-box balance" *ngIf="selectedAccount && !showValidation">
        <mat-icon>account_balance_wallet</mat-icon>
        <span>Available Balance: KSh {{ selectedAccount.balance | number:'1.2-2' }}</span>
      </div>

      <div class="info-box limit" *ngIf="!showValidation">
        <mat-icon>info</mat-icon>
        <span>Daily Limit Remaining: KSh {{ getRemainingLimit() | number:'1.2-2' }}</span>
      </div>

      <!-- Warning for insufficient balance - Shows AFTER validation -->
      <div class="warning-box" *ngIf="hasInsufficientBalance()">
        <mat-icon>warning</mat-icon>
        <span>Insufficient balance. Available: KSh {{ selectedAccount?.balance | number:'1.2-2' }}</span>
      </div>

      <!-- Warning for invalid amount - Shows AFTER validation -->
      <div class="warning-box" *ngIf="shouldShowError()">
        <mat-icon>warning</mat-icon>
        <span>Please enter a valid amount (minimum KSh 1,000)</span>
      </div>

      <div class="button-group">
        <button mat-button routerLink="/dashboard" [disabled]="isLoading">Cancel</button>
        <button mat-raised-button color="accent" (click)="withdraw()" [disabled]="isLoading">
          <span *ngIf="!isLoading">Withdraw KSh {{ amount | number:'1.2-2' }}</span>
          <span *ngIf="isLoading">Processing...</span>
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>